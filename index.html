<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Babita Ghalleyâ€™s Portfolio</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Roboto+Slab:wght@700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth;}
body{
Â font-family:'Roboto',sans-serif;
Â min-height:100vh;
Â display:flex;
Â flex-direction:column;
Â color:#222;
Â background: linear-gradient(135deg,#f6d365,#fda085);
Â position: relative;
Â overflow-x: hidden;
}

/* Dynamic Starry Background */
canvas#stars {
Â position: fixed;
Â top:0;
Â left:0;
Â width:100%;
Â height:100%;
Â z-index:0;
Â pointer-events:none;
}

/* Header */
header{
Â background:rgba(255,255,255,0.9);
Â color:#222;
Â padding:15px 20px;
Â font-size:22px;
Â font-weight:bold;
Â display:flex;
Â align-items:center;
Â justify-content:space-between;
Â box-shadow:0 3px 6px rgba(0,0,0,0.2);
Â position:sticky;
Â top:0;
Â z-index:100;
Â font-family:'Roboto Slab',serif;
Â border-bottom-left-radius:12px;
Â border-bottom-right-radius:12px;
Â flex-wrap:wrap;
Â backdrop-filter: blur(5px);
}
#menuBtn{
Â background:#3ec7c1;
Â border:none;
Â font-size:24px;
Â cursor:pointer;
Â margin-right:15px;
Â width:50px;
Â height:50px;
Â display:flex;
Â align-items:center;
Â justify-content:center;
Â border-radius:12px;
Â transition: transform .3s, background .3s, box-shadow .3s;
}
#menuBtn:hover{
Â transform: rotate(90deg) scale(1.1);
Â background:#34a9a3;
Â box-shadow:0 4px 12px rgba(0,0,0,0.2);
}
#headerTitle{flex:1;text-align:center}

/* Search Bar + Clear Button */
.search-container{position:relative;display:flex;align-items:center;}
#searchBar{
Â border:2px solid #3ec7c1;
Â border-radius:8px;
Â padding:8px 30px 8px 12px;
Â font-size:16px;
Â width:200px;
Â transition:width .3s, box-shadow .3s;
}
#searchBar:focus{
Â outline:none;
Â width:250px;
Â box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
#clearSearch{
Â position:absolute;
Â right:8px;
Â font-size:18px;
Â cursor:pointer;
Â color:#3ec7c1;
Â display:none;
Â background:none;
Â border:none;
}

/* Breadcrumb */
#breadcrumb{
Â background:rgba(255,255,255,0.75);
Â padding:10px 25px;
Â font-size:16px;
Â display:flex;
Â flex-wrap:wrap;
Â align-items:center;
Â gap:6px;
Â backdrop-filter: blur(4px);
Â z-index:1;
}
#breadcrumb span{
Â cursor:pointer;
Â color:#007b7f;
Â font-weight:600;
}
#breadcrumb span:hover{text-decoration:underline;}
#breadcrumb .divider{color:#333;}

/* Grid */
#grid{
Â display:grid;
Â grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
Â gap:20px;
Â padding:20px;
Â flex:1;
Â transition:background .2s;
Â position: relative;
Â z-index:1;
}
.tile{
Â background:#fff;
Â border-radius:16px;
Â padding:15px;
Â text-align:center;
Â font-size:16px;
Â font-weight:bold;
Â cursor:pointer;
Â transition:transform .3s, box-shadow .3s, background .3s;
Â position:relative;
Â opacity:0;
Â animation:fadeIn .5s forwards;
Â outline:none;
Â box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
.tile:hover,.tile:focus{
Â transform:scale(1.05) rotate(-1deg);
Â box-shadow:0 10px 20px rgba(0,0,0,0.2);
}
@keyframes fadeIn{to{opacity:1}}
.tile img{
Â width:100%;
Â height:140px;
Â object-fit:cover;
Â border-radius:12px;
Â margin-top:10px;
}
.tile-label{font-size:16px;font-weight:bold;}
.tile-meta{font-size:12px;margin-top:6px;color:#555;}

/* Menus */
#menuDropdown,#contextMenu{
Â display:none;
Â position:fixed;
Â background:#3ec7c1;
Â padding:10px;
Â border-radius:12px;
Â z-index:1000;
Â box-shadow:0 6px 12px rgba(0,0,0,0.2);
}
#menuDropdown button,#contextMenu button{
Â display:flex;
Â align-items:center;
Â gap:10px;
Â background:none;
Â border:none;
Â font-size:16px;
Â padding:10px;
Â cursor:pointer;
Â width:100%;
Â text-align:left;
Â border-radius:6px;
Â transition:background .2s, transform .2s;
}
#menuDropdown button:hover,#contextMenu button:hover{
Â background:rgba(0,0,0,0.1);
Â transform: scale(1.02);
}

/* Preview Modal */
#previewModal{
Â display:none;
Â position:fixed;
Â top:0;left:0;width:100%;height:100%;
Â background:rgba(0,0,0,0.85);
Â justify-content:center;
Â align-items:center;
Â z-index:2000;
Â flex-direction:column;
Â padding:20px;
}
#previewModal img,#previewModal iframe{
Â max-width:90%;
Â max-height:80%;
Â border-radius:12px;
Â box-shadow:0 0 20px rgba(255,255,255,0.3);
}
#closePreview{
Â position:absolute;
Â top:20px;right:30px;
Â font-size:32px;
Â color:white;
Â cursor:pointer;
Â font-weight:bold;
}

#grid.dragover{background:rgba(0,0,0,0.05);}

@media (max-width:600px){
Â header{font-size:18px;padding:12px 15px;flex-direction:column;}
Â #menuBtn{width:40px;height:40px;font-size:20px;margin:10px 0;}
Â #searchBar{width:100%;margin-top:8px;}
Â .tile img{height:120px;}
}
</style>
</head>
<body>

<canvas id="stars"></canvas>

<header>
Â <button id="menuBtn" aria-label="Menu">â˜°</button>
Â <span id="headerTitle">Welcome to Babita Ghalleyâ€™s Portfolio</span>
Â <div class="search-container">
Â  Â <input type="text" id="searchBar" placeholder="Search...">
Â  Â <button id="clearSearch" aria-label="Clear Search">&times;</button>
Â </div>
</header>

<div id="breadcrumb"></div>

<div id="menuDropdown">
Â <button id="newFolderBtn">ğŸ“ New Folder</button>
Â <button id="fileUploadBtn">ğŸ“¤ File Upload</button>
Â <button id="folderUploadBtn">ğŸ“‚ Folder Upload</button>
</div>

<div id="contextMenu">
Â <button id="renameBtn">âœï¸ Rename</button>
Â <button id="deleteBtn">ğŸ—‘ Delete</button>
</div>

<input type="file" id="fileInput" multiple style="display:none;">
<input type="file" id="folderInput" webkitdirectory directory multiple style="display:none;">

<div id="grid"></div>

<div id="previewModal">
Â <span id="closePreview" aria-label="Close Preview">&times;</span>
Â <img id="previewImg" src="" alt="" style="display:none;">
Â <iframe id="previewFile" style="display:none;" frameborder="0"></iframe>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.24.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.24.0/firebase-analytics.js";
// â­ï¸ NEW: Realtime Database imports
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.24.0/firebase-database.js";
import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.24.0/firebase-storage.js";

// Firebase config
const firebaseConfig = {
Â  apiKey: "AIzaSyA1CadaPw5ge4zrbllo7o4VTMwu2Xd-vw0",
Â  authDomain: "folder-86dc1.firebaseapp.com",
Â  projectId: "folder-86dc1",
Â  storageBucket: "folder-86dc1.appspot.com",Â 
Â  messagingSenderId: "253312968549",
Â  appId: "1:253312968549:web:bd08448e639206e621638c",
Â  measurementId: "G-CKZYJJPDM3"
};
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const storage = getStorage(app);
// â­ï¸ NEW: Initialize Realtime Database
const db = getDatabase(app);

// Helper to upload file and return URL
window.firebaseStorage = {
Â  async uploadFileToFirebase(file, path="") {
Â  Â  const sRef = storageRef(storage, path + file.name);
Â  Â  await uploadBytes(sRef, file);
Â  Â  return await getDownloadURL(sRef);
Â  }
};

// â­ï¸ NEW: Helper to save/load the entire data structure to/from a single DB key
window.firebaseDB = {
    // Saves the entire root data structure to the database
    async saveRoot(rootData) {
        const dbRef = ref(db, 'portfolio_content');
        
        // Function to create a clean, non-circular version of the data for the DB
        function cleanData(item) {
            const cleanItem = { ...item };
            // Remove the circular 'parent' reference before saving
            delete cleanItem.parent; 
            
            // Recursively clean children arrays
            if (cleanItem.children && Array.isArray(cleanItem.children)) {
                cleanItem.children = cleanItem.children.map(child => cleanData(child));
            }
            return cleanItem;
        }

        const dataToSave = cleanData(rootData);
        return set(dbRef, dataToSave);
    },
    // Sets up a listener to load data once and then update the root structure
    loadRoot(callback) {
        const dbRef = ref(db, 'portfolio_content');
        
        // Function to reconstruct the circular 'parent' links after loading
        function restoreParentLinks(item, parent) {
            item.parent = parent;
            if (item.children && Array.isArray(item.children)) {
                item.children.forEach(child => restoreParentLinks(child, item));
            }
        }

        // Listen for value changes
        onValue(dbRef, (snapshot) => {
            let data = snapshot.val();
            if (data) {
                // Restore parent links after data is fetched from DB
                restoreParentLinks(data, null);
                callback(data);
            }
        }, {
            // onlyOnce: true for initial load, but we use false to sync changes (optional, but good practice)
            onlyOnce: false 
        });
    }
};
</script>

<script>
// ----- Animated Star Background + Shooting Stars -----
const canvas = document.getElementById('stars');
const ctx = canvas.getContext('2d');
let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;
let stars = [];
const STAR_COUNT = 150;
let shootingStars = [];

function initStars(){
Â stars=[];
Â for(let i=0;i<STAR_COUNT;i++){
Â  Â stars.push({
Â  Â  Â x: Math.random()*W,
Â  Â  Â y: Math.random()*H,
Â  Â  Â r: Math.random()*1.5+0.5,
Â  Â  Â dx: (Math.random()-0.5)*0.2,
Â  Â  Â dy: (Math.random()-0.5)*0.2,
Â  Â  Â alpha: Math.random()
Â  Â });
Â }
}
function drawStars(){
Â ctx.clearRect(0,0,W,H);
Â for(let s of stars){
Â  Â ctx.beginPath();
Â  Â ctx.arc(s.x,s.y,s.r,0,2*Math.PI);
Â  Â ctx.fillStyle = `rgba(255,255,255,${s.alpha})`;
Â  Â ctx.fill();
Â  Â s.x += s.dx;
Â  Â s.y += s.dy;
Â  Â s.alpha += (Math.random()-0.5)*0.02;
Â  Â if(s.alpha<0) s.alpha=0;
Â  Â if(s.alpha>1) s.alpha=1;
Â  Â if(s.x>W) s.x=0; if(s.x<0) s.x=W;
Â  Â if(s.y>H) s.y=0; if(s.y<0) s.y=H;
Â }
Â // Shooting stars
Â for(let i=shootingStars.length-1;i>=0;i--){
Â  Â const s = shootingStars[i];
Â  Â ctx.beginPath();
Â  Â ctx.moveTo(s.x, s.y);
Â  Â ctx.lineTo(s.x - s.length*s.vx, s.y - s.length*s.vy);
Â  Â ctx.strokeStyle = `rgba(255,255,255,${s.alpha})`;
Â  Â ctx.lineWidth = 2;
Â  Â ctx.stroke();
Â  Â s.x += s.vx*s.speed;
Â  Â s.y += s.vy*s.speed;
Â  Â s.alpha -= 0.02;
Â  Â if(s.alpha<=0 || s.x>W || s.y>H){ shootingStars.splice(i,1); }
Â }
Â requestAnimationFrame(drawStars);
}
function spawnShootingStar(){
Â const s = {
Â  Â x: Math.random()*W*0.5,
Â  Â y: Math.random()*H*0.5,
Â  Â vx: Math.random()*2+1,
Â  Â vy: Math.random()*2+1,
Â  Â speed: Math.random()*5+3,
Â  Â length: Math.random()*80+50,
Â  Â alpha:1
Â };
Â shootingStars.push(s);
Â setTimeout(spawnShootingStar, Math.random()*3000+2000);
}
window.addEventListener('resize',()=>{
Â W=canvas.width=window.innerWidth;
Â H=canvas.height=window.innerHeight;
Â initStars();
});
initStars();
drawStars();
spawnShootingStar();

// ----- Portfolio Functionality + Firebase Storage & Database -----
(function(){
const colors=["#ffd6e0","#c3f0ca","#a0c4ff","#ffc6ff","#fffffc","#faffd1","#c1e1c1"];
let colorIndex=0;
const grid=document.getElementById('grid');
const header=document.getElementById('headerTitle');
const menuBtn=document.getElementById('menuBtn');
const menu=document.getElementById('menuDropdown');
const contextMenu=document.getElementById('contextMenu');
const renameBtn=document.getElementById('renameBtn');
const deleteBtn=document.getElementById('deleteBtn');
const fileInput=document.getElementById('fileInput');
const folderInput=document.getElementById('folderInput');
const searchBar=document.getElementById('searchBar');
const clearSearch=document.getElementById('clearSearch');
const breadcrumb=document.getElementById('breadcrumb');
const previewModal=document.getElementById('previewModal');
const previewImg=document.getElementById('previewImg');
const previewFile=document.getElementById('previewFile');
const closePreview=document.getElementById('closePreview');
// â­ï¸ UPDATED: Removed initial dummy structure to allow DB to populate it
let root={name:"Welcome to Babita Ghalleyâ€™s Portfolio",children:[],parent:null};
let current=root;
let selectedItem=null;

// â­ï¸ NEW: Function to save the entire tree
function saveChanges() {
    window.firebaseDB.saveRoot(root);
}

function createTile(item){
const tile=document.createElement('div'); tile.className='tile'; tile.tabIndex=0;
tile.style.background=colors[colorIndex % colors.length]; colorIndex++;
const label=document.createElement('div'); label.className='tile-label';
label.textContent=item.isFile ? "ğŸ“„ "+item.name : "ğŸ“ "+item.name; tile.appendChild(label);
if(item.meta){ const meta=document.createElement('div'); meta.className='tile-meta'; meta.textContent=item.meta; tile.appendChild(meta); }
if(item.isFile && item.url && item.name.match(/\.(jpg|jpeg|png|gif|bmp|webp)$/i)){
Â  const img=document.createElement('img'); img.src=item.url; img.alt=item.name; tile.appendChild(img);
}
const open=()=>item.isFile?openPreview(item):navigateFolder(item);
tile.addEventListener('click',open);
tile.addEventListener('keydown',e=>{if(e.key==="Enter")open();});
tile.addEventListener('contextmenu',e=>{
Â  e.preventDefault();
Â  selectedItem=item;
Â  contextMenu.style.display='block';
Â  contextMenu.style.left=e.pageX+'px';
Â  contextMenu.style.top=e.pageY+'px';
});
grid.appendChild(tile);
}

function navigateFolder(folder){current=folder;render();}
function render(){
grid.innerHTML=''; header.textContent=current.name;
updateBreadcrumb();
const searchTerm=searchBar.value.toLowerCase();
current.children
Â  .filter(c=>c.name.toLowerCase().includes(searchTerm))
Â  .forEach(c=>createTile(c));
}
function updateBreadcrumb(){
breadcrumb.innerHTML='';
const path=[]; let temp=current;
while(temp){path.unshift(temp);temp=temp.parent;}
path.forEach((folder,idx)=>{
Â  const span=document.createElement('span');
Â  span.textContent=(idx===0)?'Home':folder.name;
Â  span.addEventListener('click',()=>{current=folder;render();});
Â  breadcrumb.appendChild(span);
Â  if(idx<path.length-1){
Â  Â  const divider=document.createElement('span');
Â  Â  divider.textContent=' / ';
Â  Â  divider.className='divider';
Â  Â  breadcrumb.appendChild(divider);
Â  }
});
}

// â­ï¸ UPDATED: Saves changes to DB
function addFolder(name){ 
    const folder={name,children:[],parent:current}; 
    current.children.push(folder); 
    saveChanges(); // Save after local change
    render(); 
}

// â­ï¸ UPDATED: Saves changes to DB after file upload
async function addFile(file){
Â  const url = await window.firebaseStorage.uploadFileToFirebase(file, current.name + "/");
Â  current.children.push({name:file.name,isFile:true,meta:humanFileSize(file.size),parent:current,url});
  saveChanges(); // Save after local change
Â  render();
}

function humanFileSize(size){ if(size===0)return"0 B"; const i=Math.floor(Math.log(size)/Math.log(1024)); const sizes=['B','KB','MB','GB','TB']; return (size/Math.pow(1024,i)).toFixed((i===0)?0:1)+' '+sizes[i]; }

function openPreview(item){ previewModal.style.display='flex'; if(item.name.match(/\.(jpg|jpeg|png|gif|bmp|webp)$/i)){ previewImg.src=item.url; previewImg.style.display='block'; previewFile.style.display='none'; }else{ previewFile.src=item.url; previewFile.style.display='block'; previewImg.style.display='none'; } previewModal.dataset.currentUrl=item.url; }
function closePreviewModal(){ previewModal.style.display='none'; if(previewModal.dataset.currentUrl)URL.revokeObjectURL(previewModal.dataset.currentUrl); previewImg.src=''; previewFile.src=''; previewModal.dataset.currentUrl=''; }
closePreview.addEventListener('click',closePreviewModal);
window.addEventListener('click',e=>{if(e.target===previewModal)closePreviewModal();});
window.addEventListener('keydown',e=>{if(e.key==='Escape')closePreviewModal();});
function toggleMenu(e){ e.stopPropagation(); menu.style.display=(menu.style.display==='block')?'none':'block'; }
menuBtn.addEventListener('click',toggleMenu);
document.getElementById('newFolderBtn').addEventListener('click',()=>{ const name=prompt("Folder name:","New Folder"); if(name&&name.trim()){addFolder(name.trim());menu.style.display='none';} });

document.getElementById('fileUploadBtn').addEventListener('click',()=>{ fileInput.value=null; fileInput.click(); });
fileInput.addEventListener('change', async e=>{Â 
Â  menu.style.display='none';Â 
Â  const files = Array.from(e.target.files);
Â  for(const file of files) await addFile(file);
});

document.getElementById('folderUploadBtn').addEventListener('click',()=>{ folderInput.value=null; folderInput.click(); });
folderInput.addEventListener('change', async e=>{Â 
Â  menu.style.display='none';Â 
Â  await handleFolderUpload(e.target.files);
});

// â­ï¸ UPDATED: Saves changes to DB after folder upload
async function handleFolderUpload(files){Â 
Â  const arr=Array.from(files||[]);Â 
Â  if(arr.length===0) return;Â 
Â  const rootMap=new Map();Â 
Â  arr.forEach(f=>{
Â  Â  const rel=f.webkitRelativePath||f.name;Â 
Â  Â  const root=rel.includes('/')?rel.split('/')[0]:rel;Â 
Â  Â  const list=rootMap.get(root)||[]; list.push(f); rootMap.set(root,list);
Â  });
Â  for(const [rootName,list] of rootMap){
Â  Â  const folder={name:rootName,children:[],parent:current};
Â  Â  for(const f of list){
Â  Â  Â  const url=await window.firebaseStorage.uploadFileToFirebase(f, current.name + "/" + rootName + "/");
Â  Â  Â  folder.children.push({name:f.name,isFile:true,meta:humanFileSize(f.size),parent:folder,url});
Â  Â  }
Â  Â  current.children.push(folder);
Â  }
  saveChanges(); // Save after local change
Â  render();
}

searchBar.addEventListener('input',()=>{ clearSearch.style.display=searchBar.value?'block':'none'; render(); });
clearSearch.addEventListener('click',()=>{ searchBar.value='';clearSearch.style.display='none';render(); });
window.addEventListener('click',e=>{ if(!menu.contains(e.target)&&!menuBtn.contains(e.target)&&!contextMenu.contains(e.target)){ menu.style.display='none'; contextMenu.style.display='none'; } });
window.addEventListener('keydown',e=>{ if(e.key==='Escape'){ menu.style.display='none'; contextMenu.style.display='none'; } });

// â­ï¸ UPDATED: Saves changes to DB after rename
renameBtn.addEventListener('click',()=>{ 
    if(selectedItem){ 
        const name=prompt("Rename:",selectedItem.name); 
        if(name&&name.trim()){
            selectedItem.name=name.trim();
            saveChanges(); // Save after local change
            render();
        } 
        contextMenu.style.display='none'; 
    } 
});

// â­ï¸ UPDATED: Saves changes to DB after delete
deleteBtn.addEventListener('click',()=>{ 
    if(selectedItem&&selectedItem.parent){ 
        selectedItem.parent.children=selectedItem.parent.children.filter(c=>c!==selectedItem); 
        selectedItem=null;
        saveChanges(); // Save after local change
        render();
        contextMenu.style.display='none'; 
    } 
});

// â­ï¸ NEW: Function to handle initial data load from DB
function initializeApp() {
    window.firebaseDB.loadRoot((loadedRoot) => {
        // If data was loaded from the DB, use it
        if (loadedRoot) {
            root = loadedRoot;
            // The logic below ensures 'current' is set correctly after the load
            
            // Find the current folder path in the old 'current' object
            const currentPath = [];
            let temp = current;
            while(temp && temp.name !== root.name) {
                currentPath.unshift(temp.name);
                temp = temp.parent;
            }

            // Navigate the new 'root' structure to the old 'current' location
            let newCurrent = root;
            for (const name of currentPath) {
                const child = newCurrent.children.find(c => c.name === name);
                if (child) {
                    newCurrent = child;
                } else {
                    // Path was deleted or changed, revert to root
                    newCurrent = root;
                    break;
                }
            }
            current = newCurrent;
            
        } else {
            // If the database is empty, create the initial dummy folders and save them
            ["Year 2021","Year 2022","Year 2023","Year 2024","Year 2025","Year 2026"].forEach(addFolder);
            // NOTE: The addFolder call above already calls saveChanges().
        }
        render();
    });
}

// â­ï¸ Start the app by loading from DB
initializeApp();

// â­ï¸ REMOVED: Initial dummy folder creation moved inside initializeApp
// ["Year 2021","Year 2022","Year 2023","Year 2024","Year 2025","Year 2026"].forEach(addFolder);

})();
</script>
</body>
</html>
